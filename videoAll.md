# 项目需求文档 (Final Version): 内容解析、管理与热点发现系统

## 项目概述

本系统旨在开发一个功能完备的后台管理系统，为核心用户（内容运营者、管理员）提供一体化的内容资产管理解决方案。系统核心价值在于打通“**热点发现 -> 精准采集 -> 有序存储 -> 可视化管理**”的全流程。

**核心功能模块**：
1.  **单作品解析**：输入任一内容平台链接，系统解析并保存**无水印**的原始媒体文件及元数据。
2.  **作者作品监控**：创建定时任务，持续监控指定创作者，自动采集其新发布的作品。
3.  **内容管理与存储**：对所有采集内容进行集中化管理，并按照**清晰的物理存储规则**保存文件。
4.  **任务调度中心**：统一管理所有自动化任务（监控、热搜抓取）的生命周期与状态。
5.  **平台热搜发现**：定时抓取、归档与查询各主流平台热搜榜，用于趋势洞察与选题发现。
6.  **数据可视化看板**：提供多维度数据仪表盘，直观展示内容资产概况与运营效率。
7.  **系统配置管理**：包含用户权限管理及平台账户（Cookie）配置，保障系统安全与解析成功率。

---
## 功能需求列表 (Epics & User Stories)

### Epic 1: 单作品解析
**描述**：通过输入作品分享链接，系统后端调用相应解析服务，下载无水印的媒体文件（视频/图片）并提取关键元数据，保存至系统中。

#### User Story 1.1: 提交并解析单个作品链接
**作为** 内容运营者，
**我希望** 在后台输入一个内容链接（如抖音、小红书分享链接），一键提交解析，
**以便** 快速获得该作品的无水印源文件。

**验收标准（AC）：**
- AC1.1.1: 前台提供清晰的输入框和“解析”按钮。
- AC1.1.2: 支持主流平台链接识别（如抖音、快手、小红书、B站、微博视频等）。
- AC1.1.3: 提交后，后台应异步处理，前端显示“解析中”状态。
- AC1.1.4: 解析成功后，作品详情（标题、作者、封面图、媒体文件等）自动入库，并在内容库列表可见。
- AC1.1.5: 解析失败时，前端需提示明确原因（如“链接无效”、“平台暂不支持”、“解析服务异常”）。

**优先级：** P0
**预估工时（前端）：** 2d
**预估工时（后端-解析服务集成）：** 5d

### Epic 2: 作者作品监控
**描述**：允许用户订阅特定创作者，系统根据设定的规则定期自动爬取其最新作品，实现内容采集的自动化。

#### User Story 2.1: 创建作者监控任务
**作为** 内容运营者，
**我希望** 通过输入作者主页链接或ID来创建一个监控任务，并设置抓取频率，
**以便** 系统能自动、持续地收集该作者的新作品。

**验收标准（AC）：**
- AC2.1.1: 提供任务创建界面，需填写：任务名称、目标平台、作者主页链接/ID、抓取频率（如每小时、每天、每周）。
- AC2.1.2: 系统能验证作者链接的有效性。
- AC2.1.3: 任务创建后，立即根据频率设置加入调度队列。
- AC2.1.4: 成功抓取到的作品，其`source_type`标记为“监控任务”，并按照作者名规则存储（参见Epic 3.2）。

**优先级：** P1
**预估工时（前端）：** 3d
**预估工时（后端-爬虫调度）：** 5d

### Epic 3: 内容管理与结构化存储
**描述**：提供中心化的内容库用于查看、搜索所有已采集内容，并制定明确的文件系统存储规范，实现数字资产的有序管理。

#### User Story 3.1: 查看与管理内容库
**作为** 内容运营者，
**我希望** 有一个统一的页面可以浏览、搜索和筛选所有已采集的作品，
**以便** 高效地查找和使用我的内容资产。

**验收标准（AC）：**
- AC3.1.1: 内容库以列表或卡片形式展示作品，关键信息可见：封面、标题、作者、平台、采集时间。
- AC3.1.2: 支持多维度筛选：按平台、内容类型（视频/图文）、作者、采集时间范围、关键词搜索。
- AC3.1.3: 可对单条内容进行操作：预览媒体、查看详情、下载源文件、删除。
- AC3.1.4: 支持批量操作，如批量删除、批量导出链接。

**优先级：** P1
**预估工时（前端）：** 5d
**预估工时（后端）：** 2d

#### User Story 3.2: 实现结构化文件存储规范
**作为** 系统管理员，
**我希望** 系统能根据内容来源，自动将文件保存到逻辑清晰的目录结构中，
**以便** 在服务器文件系统上也能直观、有序地管理物理文件。

**验收标准（AC）：**
- AC3.2.1: 所有文件存储于可配置的根路径下（如`/data/media/`）。
- AC3.2.2: 根目录下按平台划分（`douyin/`, `xiaohongshu/`）。
- AC3.2.3: 平台目录下，按来源创建二级文件夹：
    - **来自监控任务**：文件夹名为`作者名称`。
    - **来自单链接解析**：文件夹名为`作品标题`（经清洗处理）。
- AC3.2.4: 媒体文件以`{作品ID}_{时间戳}.{后缀}`格式命名。
- AC3.2.5: 数据库`content`表的`file_path`字段准确记录相对路径。
- AC3.2.6: 命名冲突时，自动追加序号（如`作者名(1)`）。

**优先级：** P1
**预估工时（后端-文件服务层）：** 3d

### Epic 4: 任务调度与管理
**描述**：提供后台界面，统一查看和管理所有自动化任务（作者监控、热搜抓取）的执行状态与历史日志。

#### User Story 4.1: 管理监控任务列表
**作为** 系统管理员，
**我希望** 能集中查看所有已创建的作者监控任务，并控制其运行状态，
**以便** 统一管理和维护这些自动化任务。

**验收标准（AC）：**
- AC4.1.1: 任务列表展示：任务名、目标作者、平台、抓取频率、最近执行时间、下次执行时间、状态（启用/禁用）。
- AC4.1.2: 支持对任务执行启用、禁用、立即执行一次、编辑、删除操作。
- AC4.1.3: 可查看每个任务的历史执行日志，包括每次执行的起止时间、成功/失败状态、抓取作品数量或失败原因。

**优先级：** P1
**预估工时（前端）：** 4d
**预估工时（后端）：** 3d

#### User Story 4.2: 查看热搜抓取任务状态
**作为** 系统管理员，
**我希望** 在任务管理页面能看到热搜抓取系统任务的执行状态，
**以便** 确保热点数据源的稳定更新。

**验收标准（AC）：**
- AC4.2.1: 任务列表中展示名为“每日热搜抓取（平台名）”的系统任务。
- AC4.2.2: 展示其最后执行时间、下次执行时间及状态。
- AC4.2.3: 可查看该任务的历史执行日志。

**优先级：** P2
**预估工时（后端）：** 1d

### Epic 5: 用户与权限管理
**描述**：实现多用户系统，支持基于角色的访问控制，确保系统操作安全。

#### User Story 5.1: 用户登录与基础权限
**作为** 系统管理员，
**我希望** 能管理用户账号并分配不同角色（如管理员、运营人员），
**以便** 控制他们对系统功能的访问权限。

**验收标准（AC）：**
- AC5.1.1: 实现用户名/密码登录系统。
- AC5.1.2: 管理员可创建、编辑、禁用用户账号。
- AC5.1.3: 至少定义两种角色：`管理员`（所有权限）、`运营者`（仅内容采集、查看、管理等业务权限，无系统配置权限）。
- AC5.1.4: 前后端接口需进行权限校验。

**优先级：** P1
**预估工时（前后端）：** 4d

### Epic 6: 平台账户配置
**描述**：为各内容平台配置登录态信息，以提升解析和爬取服务的成功率与稳定性。

#### User Story 6.1: 管理平台Cookie配置
**作为** 系统管理员，
**我希望** 有一个安全的地方来配置和维护各个平台的登录Cookie，
**以便** 后端解析服务在需要时能使用这些信息。

**验收标准（AC）：**
- AC6.1.1: 提供配置界面，选择平台（抖音、小红书等）并粘贴对应的Cookie字符串。
- AC6.1.2: Cookie信息在数据库中**加密存储**。
- AC6.1.3: 可测试Cookie的有效性（通过调用一个简单的验证接口）。
- AC6.1.4: 支持为同一平台配置多个备用Cookie账户。

**优先级：** P1
**预估工时（前端）：** 2d
**预估工时（后端）：** 2d

### Epic 7: 数据统计与看板
**描述**：提供可视化数据仪表盘，集中展示系统内内容资产与运营效率的核心指标。

#### User Story 7.1: 查看核心数据概览
**作为** 系统管理员，
**我希望** 在首页看到核心数据卡片与图表，
**以便** 快速掌握系统内容资产总量与分布。

**验收标准（AC）：**
- AC7.1.1: 看板页面布局美观，信息清晰。
- AC7.1.2: 展示核心指标卡：内容总数、视频数、图文数、今日新增、活跃任务数。
- AC7.1.3: 展示平台分布环图、内容类型对比图、近期采集趋势折线图。
- AC7.1.4: 数据支持自动刷新。

**优先级：** P1
**预估工时（前端 - 图表）：** 5d
**预估工时（后端 - 统计接口）：** 3d

### Epic 8: 平台热搜发现与洞察
**描述**：定时从各平台抓取热搜榜单并提供历史查询功能，赋能热点趋势分析。

#### User Story 8.1: 配置热搜抓取任务
**作为** 系统管理员，
**我希望** 能设定需要抓取的平台和抓取频率，
**以便** 系统自动更新热搜数据。

**验收标准（AC）：**
- AC8.1.1: 提供“热搜源管理”界面，可启用/禁用平台。
- AC8.1.2: 可设定抓取频率（默认每日一次）。
- AC8.1.3: 抓取时优先使用Epic 6中配置的对应平台Cookie。

**优先级：** P1
**预估工时（前端）：** 2d
**预估工时（后端）：** 2d

#### User Story 8.2: 查看与查询历史热搜榜
**作为** 内容运营者，
**我希望** 能按平台和日期查询热搜榜单，
**以便** 分析热点趋势或进行复盘。

**验收标准（AC）：**
- AC8.2.1: 默认展示今日各平台热搜。
- AC8.2.2: 提供筛选器：多选平台、选择历史日期。
- AC8.2.3: 榜单列表展示排名、关键词、热度、趋势标签。
- AC8.2.4: 点击热搜可展开查看关联内容摘要。
- AC8.2.5: 提供“一键解析”按钮，快速采集关联热点内容。

**优先级：** P0
**预估工时（前端）：** 6d
**预估工时（后端）：** 3d

---
## 非功能性需求

1.  **前端技术栈**：使用 **Ant Design** 组件库及 `@ant-design/charts` 构建用户界面。
2.  **性能要求**：
    - 常规页面加载时间应低于3秒。
    - 数据看板、复杂查询接口需使用**缓存策略**（如Redis），确保响应速度。
    - 文件存储架构需支持未来扩展至对象存储（如OSS/S3）。
3.  **安全性要求**：
    - 所有通信必须使用 **HTTPS**。
    - 用户密码、平台Cookie等敏感信息在数据库中必须**加密存储**。
    - 实施严格的权限校验，防止越权操作。
    - 对用户输入（如文件名、作者名）进行清洗和转义，防范目录遍历等攻击。
4.  **可靠性**：
    - 核心解析与爬虫服务需具备重试机制和降级策略。
    - 数据库需定期备份。
5.  **合规性声明**：
    - 系统仅供内部使用，必须明确提示用户遵守各内容平台的Robots协议及服务条款。
    - 采集的数据不得用于非法用途。

---
## 数据字典（核心表结构）

### 用户表 (`user`)
| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT | 主键 |
| `username` | VARCHAR(50) | 用户名，唯一 |
| `password_hash` | VARCHAR(255) | 加密后的密码 |
| `role` | VARCHAR(20) | 角色：`admin`, `operator` |
| `is_active` | TINYINT(1) | 账户是否启用 |
| `created_at` | DATETIME | 创建时间 |

### 内容表 (`content`)
| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT | 主键 |
| `platform` | VARCHAR(20) | 来源平台 |
| `content_id` | VARCHAR(100) | 平台侧作品ID |
| `title` | VARCHAR(500) | 作品标题 |
| `author` | VARCHAR(100) | 作者名 |
| `description` | TEXT | 作品描述 |
| `media_type` | VARCHAR(10) | 类型：`video`, `image` |
| `file_path` | VARCHAR(500) | **媒体文件相对路径** (如 `douyin/作者名/123.mp4`) |
| `cover_url` | VARCHAR(500) | 封面图URL |
| `source_url` | VARCHAR(500) | 原始分享链接 |
| `source_type` | TINYINT | **来源**：1-单链接解析，2-监控任务 |
| `task_id` | BIGINT NULL | 若为监控任务，关联`crawl_task.id` |
| `created_at` | DATETIME | 采集时间 |

### 爬虫任务表 (`crawl_task`)
| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT | 主键 |
| `name` | VARCHAR(100) | 任务名称 |
| `platform` | VARCHAR(20) | 目标平台 |
| `target_identifier` | VARCHAR(200) | 作者ID或主页链接 |
| `frequency` | VARCHAR(20) | 执行频率：`hourly`, `daily`等 |
| `status` | TINYINT | 状态：1-启用，0-禁用 |
| `last_run_at` | DATETIME NULL | 上次执行时间 |
| `next_run_at` | DATETIME NULL | 下次计划执行时间 |
| `config` | JSON | 额外配置（如过滤条件） |

### 平台账户配置表 (`platform_account`)
| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT | 主键 |
| `platform` | VARCHAR(20) | 平台名称 |
| `account_alias` | VARCHAR(50) | 账户别名（用于识别） |
| `cookies_encrypted` | TEXT | 加密存储的Cookie字符串 |
| `is_valid` | TINYINT(1) | 有效性状态 |
| `last_checked_at` | DATETIME | 最后校验时间 |

### 热搜快照表 (`hotsearch_snapshot`)
| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | BIGINT | 主键 |
| `platform` | VARCHAR(20) | 平台 |
| `capture_date` | DATE | 抓取日期 |
| `capture_time` | DATETIME | 具体抓取时间 |
| `snapshot_data` | JSON | **热搜榜单完整JSON** |
| `created_at` | DATETIME | 记录创建时间 |
| **唯一索引** | (`platform`, `capture_date`) | 防止重复抓取 |

---
## 输出说明

本文档已按照 **Trae平台** 可识别的标准Markdown格式进行结构化编写：
- 使用 `#`, `##`, `###` 表示需求层级（项目 -> Epic -> User Story）。
- 每个User Story均包含标准格式的 **描述**、**验收标准（AC）**、**优先级（P0/P1/P2）** 和 **预估工时（x d）**。
- 所有功能点均已拆解为独立、可分配和可验收的开发任务。
- 可直接导入Trae用于创建项目计划、任务分解和进度跟踪。