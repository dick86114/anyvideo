<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .result {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>APIè¿æ¥æµ‹è¯•</h1>

    <button onclick="testAPI()">æµ‹è¯•å†…å®¹åˆ—è¡¨API</button>
    <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
    <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>

    <div id="results"></div>

    <script>
        async function testAPI() {
            const resultsDiv = document.getElementById('results');

            try {
                addResult('ğŸ”„ æ­£åœ¨æµ‹è¯•API...', 'info');

                const response = await fetch('http://localhost:3000/api/v1/content', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                addResult(`âœ… APIè°ƒç”¨æˆåŠŸï¼`, 'success');
                addResult(`ğŸ“Š è¿”å›æ•°æ®: ${JSON.stringify(data, null, 2)}`, 'success');

                if (data.data && data.data.list && data.data.list.length === 0) {
                    addResult('ğŸ‰ æ•°æ®åº“ç¡®å®æ˜¯ç©ºçš„ï¼', 'success');
                } else {
                    addResult('âš ï¸ æ•°æ®åº“ä¸­ä»æœ‰æ•°æ®', 'error');
                }

            } catch (error) {
                addResult(`âŒ APIè°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function clearCache() {
            // æ¸…é™¤æ‰€æœ‰å­˜å‚¨
            localStorage.clear();
            sessionStorage.clear();

            // æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆé€šè¿‡æ·»åŠ æ—¶é—´æˆ³ï¼‰
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }

            addResult('ğŸ§¹ ç¼“å­˜å·²æ¸…é™¤', 'success');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function addResult(message, type) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function () {
            addResult('ğŸ“± é¡µé¢å·²åŠ è½½ï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•', 'info');
        };
    </script>
</body>

</html>